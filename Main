from io import StringIO
import re
import pyodbc

# Function to regex search
def ExtractFields(x, y = '', z = '', occurrence = 1, text = ''):

    # initialize regex search
    Aux_search = x + y + z
    try:
        Factura_search = re.search(Aux_search, text)

        if Factura_search:
            print(Factura_search.group(1))
            return(Factura_search.group(1))

    except AttributeError:
        return ("Error")

#------------------- READ TXT FILE

#Inicializar campos
Número_Factura = "FE123123";
print(Número_Factura)
Fecha_desde_periodo_consumo = 12;
Fecha_hasta_periodo_consumo = 12;
Fecha_cargo = 12
Dirección_facturacion = "OURENSE";
A_la_atención_de = "AYTO";
TOTAL_IMPORTE_FACTURA = 100;
Fecha_lectura_anterior = "-sep-16";
Fecha_lectura_actual= "oct-16"
Lectura_anterior_periodo_punta = 66.953;
Lectura_actual_periodo_punta = 66.953;
Consumo_periodo_punta = 0;
Lectura_anterior_periodo_valle = 125.904
Lectura_actual_periodo_valle = 125.904;
Consumo_periodo_valle = 0;
Contador_nº= 46015829;
Lectura_real_maximetro = 16.75
Fecha_lectura_maximetro	= "4 de octubre de 2016";
NIF = "A"; Direccion_de_suministro = "a";
TIPO_DE_CONTRATO = "a"; TIPO_DE_CONTADOR = "a"
Numero_de_cuenta_cliente = 1;
Peaje_de_acceso = "a";
Potencia_contratada = 9;
Fecha_final_contrato = "A";
Fecha_emision_factura = "A";
CUPS = "A"

#------------------- DATABASE CONNECTION
import mysql.connector

mydb = mysql.connector.connect(
  host="localhost",
  user="root",
  passwd="MySQLFE16137007966831",
  database="Renowattio"
)


#Escritura en base de datos
mycursor = mydb.cursor()

sql = "INSERT INTO Facturas (Número_Factura, Fecha_desde_periodo_consumo, Fecha_hasta_periodo_consumo, Fecha_cargo, Dirección_facturacion, A_la_atención_de, Fecha_lectura_anterior, Fecha_lectura_actual, Lectura_anterior_periodo_punta, Lectura_actual_periodo_punta, Consumo_periodo_punta, Lectura_anterior_periodo_valle, Lectura_actual_periodo_valle, Consumo_periodo_valle, Contador_nº, Lectura_real_maximetro, Fecha_lectura_maximetro, NIF, Direccion_de_suministro, TIPO_DE_CONTRATO, TIPO_DE_CONTADOR, Numero_de_cuenta_cliente, Peaje_de_acceso, Potencia_contratada, Fecha_final_contrato, Fecha_emision_factura, CUPS) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)"
print(sql)
val = [Número_Factura, Fecha_desde_periodo_consumo, Fecha_hasta_periodo_consumo, Fecha_cargo, Dirección_facturacion, A_la_atención_de, Fecha_lectura_anterior, Fecha_lectura_actual, Lectura_anterior_periodo_punta, Lectura_actual_periodo_punta, Consumo_periodo_punta, Lectura_anterior_periodo_valle, Lectura_actual_periodo_valle, Consumo_periodo_valle, Contador_nº, Lectura_real_maximetro, Fecha_lectura_maximetro, NIF, Direccion_de_suministro, TIPO_DE_CONTRATO, TIPO_DE_CONTADOR, Numero_de_cuenta_cliente, Peaje_de_acceso, Potencia_contratada, Fecha_final_contrato, Fecha_emision_factura, CUPS]
print(val)
mycursor.execute(sql, val)

mydb.commit()

print(mycursor.rowcount, "record inserted.")